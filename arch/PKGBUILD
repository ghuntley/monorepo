# Maintainer: Vincent Ambo <dev@tazj.in>
pkgname=tazblog
pkgver=4.2
pkgrel=1
pkgdesc="Tazjin's blog written in Haskell"
arch=('i686' 'x86_64')
url="http://tazj.in"
license=('MIT')
makedepends=('ghc' 'cabal-install')
source=('tazblog@.service')
sha1sums=('6aeb901a9d0e25763c9c99168a440dd5ac99ffc1')

build() {
  cd "$srcdir"
  test -e blog-src || ln -fs ../../ blog-src
  cd blog-src

  cabal sandbox init
  cabal update
  cabal install -j --only-dependencies
  cabal build
}

package() {
  cd "$srcdir"
  cd blog-src

  # Install blog itself
  install -d "${pkgdir}/usr/bin"
  install -m755 dist/build/tazblog/tazblog "${pkgdir}/usr/bin/tazblog"

  # Install resources
  install -d "${pkgdir}/usr/share/tazblog"
  cp -r res/ "${pkgdir}/usr/share/tazblog"

  # Install service file
  install -d "${pkgdir}/usr/lib/systemd/system"
  cp "arch/tazblog@.service" "${pkgdir}/usr/lib/systemd/system/"
}
